# Week 7 - AI-Driven Code Review with Graphite

This is a FastAPI full-stack starter project focused on practicing AI-assisted code review using Graphite.

## Project Overview

**Purpose**: Educational project for exploring AI code review tools and best practices
**Focus**: Agent-driven development with Graphite Diamond AI reviews
**Tech Stack**: FastAPI + SQLite + Vanilla JavaScript frontend

## Quick Start

```bash
# Run development server
make run

# Run tests
make test

# Format and lint
make format
make lint
```

## Project Structure

```
backend/
├── app/
│   ├── main.py              # FastAPI application entry
│   ├── models.py            # SQLAlchemy ORM models
│   ├── schemas.py           # Pydantic validation schemas
│   ├── db.py                # Database configuration
│   ├── routers/             # API endpoints
│   │   ├── notes.py         # Notes CRUD + search
│   │   └── action_items.py  # Action items with completion
│   └── services/            # Business logic
│       └── extract.py       # Action item extraction
├── tests/                   # pytest test suite
frontend/
├── index.html               # Main UI
├── app.js                   # Vanilla JavaScript client
└── styles.css               # Simple styling
data/                        # SQLite database + seed
docs/                        # TASKS.md for assignment
```

## Key Features

- **FastAPI Backend**: RESTful API with automatic OpenAPI docs
- **SQLite + SQLAlchemy**: Simple database with migrations
- **Pagination & Sorting**: List endpoints support `skip`, `limit`, `sort`
- **Search**: Full-text search across notes
- **Filtering**: Filter action items by completion status
- **PATCH Endpoints**: Partial updates for resources
- **Timestamps**: `created_at` and `updated_at` on all models
- **Testing**: pytest with TestClient fixtures
- **Code Quality**: black + ruff + pre-commit hooks

## Development Workflow with Graphite

This project follows Graphite best practices for code review:

### Per-Task Workflow
1. Create separate branch for each task
2. Implement with 1-shot AI prompt
3. Manual line-by-line review with explanatory commits
4. Open Pull Request with:
   - Problem description and approach
   - Testing summary (commands + results)
   - Notable tradeoffs and limitations
5. Use Graphite Diamond for AI-assisted code review
6. Document results in `writeup.md`

### Graphite Best Practices (Critical)
- **Clear Commit Messages**: Each commit should tell a story
- **Traceable Changes**: Link commits to PR descriptions
- **Incremental Reviews**: Small, focused PRs
- **Documentation**: Update README/TASKS as features evolve
- **Testing Coverage**: Ensure new code has tests

## Current Tasks

See `docs/TASKS.md` for the 4 assignments:
1. Add more endpoints and validations
2. Extend extraction logic
3. Add new model with relationships
4. Improve tests for pagination and sorting

## Configuration

Environment variables (optional, override in `.env`):
- `DATABASE_PATH`: Path to SQLite database (default: `./data/app.db`)
- `HOST`: Server host (default: `127.0.0.1`)
- `PORT`: Server port (default: `8000`)

---

**AI Team Configuration (autogenerated by team-configurator, 2025-01-14)**

**Important: YOU MUST USE subagents when available for the task.**

### Detected Technology Stack

- **Backend Framework**: FastAPI (Python async web framework)
- **Database**: SQLite with SQLAlchemy ORM
- **Validation**: Pydantic V2 schemas
- **Testing**: pytest with FastAPI TestClient
- **Frontend**: Vanilla JavaScript (no build tools)
- **Code Quality**: black formatter, ruff linter, pre-commit hooks
- **Development Tools**: Makefile, uvicorn server

### AI Team Assignments

| Task | Agent | Description |
|------|-------|-------------|
| **FastAPI Development** | `@fastapi-expert` | All FastAPI API work, endpoints, async patterns, Pydantic V2 validation, SQLAlchemy 2.0 integration |
| **API Design** | `@api-architect` | RESTful API contracts, OpenAPI specs, endpoint structure, versioning, pagination design |
| **Code Review** | `@code-reviewer` | **MANDATORY** before every merge to main. Reviews for security, performance, maintainability with severity labels |
| **Testing Strategy** | `@testing-expert` | pytest test design, fixtures, coverage analysis, TDD methodology |
| **Performance** | `@performance-optimizer` | Query optimization, async patterns, database indexing, response time analysis |
| **Codebase Analysis** | `@code-archaeologist` | Deep exploration of unfamiliar code, architecture documentation, technical debt assessment |
| **Backend Implementation** | `@backend-developer` | General backend logic when no framework-specific agent needed |

### Graphite Integration Guidelines

Every code change must follow Graphite best practices:

1. **Commit Discipline**
   - Atomic commits with clear messages
   - Explain "why" not just "what"
   - Reference task numbers when applicable

2. **PR Hygiene**
   - Descriptive title summarizing the change
   - Detailed description with testing evidence
   - Link to related issues/tasks
   - Document tradeoffs and limitations

3. **Review Process**
   - Self-review before requesting review
   - Use Graphite Diamond AI for automated feedback
   - Address all critical issues before merge
   - Maintain review velocity - small PRs review faster

4. **Documentation**
   - Update `writeup.md` after each task
   - Keep `TASKS.md` progress current
   - Document API changes in comments/docstrings

### Example Commands

```bash
# Task 1: Add new endpoint with validation
@fastapi-expert Add DELETE endpoint for notes with proper validation and error handling

# Review implementation
@code-reviewer Review the notes DELETE endpoint implementation for security and edge cases

# Improve test coverage
@testing-expert Add comprehensive tests for the new notes DELETE endpoint including edge cases

# Analyze performance
@performance-optimizer Analyze and optimize the notes list endpoint for better query performance
```

### Project-Specific Notes

- This is an **educational project** focused on code review practices
- Keep changes **incremental and traceable** for Graphite review workflow
- Each of the 4 tasks should have its own branch and PR
- Prioritize **clear documentation** in commit messages and PR descriptions
- Test coverage is essential for effective code review

---

**Last Updated**: 2025-01-14
**Team Configurator Version**: 1.0
